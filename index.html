<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Phoros</title>
<!-- 2016-06-06 Mo 11:58 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Bert Burgemeister" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" href="style.css" type="text/css"/>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Phoros</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Workflow</a></li>
<li><a href="#sec-2">Command Line Interface</a></li>
<li><a href="#sec-3">Web Interface</a></li>
<li><a href="#sec-4">Deployment</a></li>
<li><a href="#sec-5">Licence</a></li>
<li><a href="#sec-6">Acknowledgements</a></li>
</ul>
</div>
</div>

<div class="figure">
<p><img src="phoros-logo-plain.png" alt="phoros-logo-plain.png" />
</p>
</div>

<p>
A Tool for Photogrammetric Road Survey
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Workflow</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>Images and GPS data are acquired using a measuring vehicle.
(<a href="http://tu-dresden.de/die_tu_dresden/fakultaeten/vkw/ivs/gsa/professur/ausstattung/messfahrzeug_uno">Here</a>
is a working example.)

<p>
Sequences of a few hundred images together with their trigger
times are stored Huffman-encoded in files called <code>*.pictures</code>.
GPS data is preprocessed into a table of ASCII text.  The format
of both image and GPS files is not (yet) explained here.
</p>
</li>

<li>Cameras and GPS system need to be calibrated, which is not
explained here.
</li>

<li>Calibration parameters are stored into the database using the
<a href="#sec-2">Command Line Interface</a> (There, cf.
<code>Camera Hardware Parameters</code> through
<code>Camera Calibration Parameters</code>.)
</li>

<li>GPS data and image information are fed into the database using
option <code>--store-images-and-points</code> of the <a href="#sec-2">Command Line Interface</a>.
</li>

<li>Presentation project users use the web interface to point in a map
at a point of interest and are shown a couple of relevant images.
In these images they point at features of interest the coordinates
of which can be stored into the database.  (Storage not yet
implemented; coordinates are just shown.)
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Command Line Interface</h2>
<div class="outline-text-2" id="text-2">
<p>
The command line interface is used to
</p>

<ul class="org-ul">
<li>initialize a fresh PostgreSQL database
(<code>./phoros --create-sys-tables ...</code>),
</li>

<li>set up and manage acquisition projects
(<code>./phoros --create-acquisition-project ...</code>),
</li>

<li>store camera calibration parameters (<code>--store-camera-hardware</code>,
<code>--store-device-stage-of-life</code>, <code>--store-camera-calibration</code> etc.),
</li>

<li>store measurement data, i.e., images and GPS positions
(<code>./phoros --store-images-and-points ...</code>),
</li>

<li>manage presentation projects and presentation project users
(<code>--create-presentation-project</code>, <code>--create-user</code> etc.),
</li>

<li>start Phoros as a presentation server (a web server presenting
measurement data to presentation project users) by
<code>./phoros --server ...</code>.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-sh">$ ./phoros --help
</pre>
</div>
<p>
emits a rather comprehensive <a href="phoros--help.html">help message</a>.
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Web Interface</h2>
<div class="outline-text-2" id="text-3">
<p>
Once images, calibration data and definitions of users and projects
have been stored using the <a href="#sec-2">Command Line Interface</a>, Phoros can be
started as a web server:
</p>
<div class="org-src-container">

<pre class="src src-sh">$ ./phoros --server <span style="font-style: italic;">\</span>
&gt;          --common-root=/some_path/where_i_put/my_raw_images/ <span style="font-style: italic;">\</span>
&gt;          --host=my_server --port=5432 --database=my_projects <span style="font-style: italic;">\</span>
&gt;          --user=database_admin --password=SeCrEt
</pre>
</div>
<p>
A user can than point their browser at Phoros's URL.  Example:
<code>http://localhost:8080/phoros/beautiful-cities</code> connects to
presentation project <code>beautiful-cities</code> (and asks for username and
password).
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">Choose a point from the map</h3>
<div class="outline-text-3" id="text-3-1">
<p>
In the map, small yellow circles represent points of view of the
available images.  Pointing into an area of interest has Phoros
select and display a few<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>
images containing the point clicked, which on the
streetmap is represented by the dark blue Phoros logo.
</p>


<div class="figure">
<p><img src="phoros-12.8.1.png" alt="phoros-12.8.1.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2">Point into first image</h3>
<div class="outline-text-3" id="text-3-2">
<p>
After zooming into a first image and selecting a feature of
interest, <a href="http://en.wikipedia.org/wiki/Epipolar_line#Epipolar_line">epipolar lines</a> appear in the other images which may be
helpful in recognising the selected feature there.
</p>

<p>
Points selected in images are represented by large yellow circles.
</p>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3">Point into second image</h3>
<div class="outline-text-3" id="text-3-3">
<p>
Zooming in and selecting the same feature in a second image
triggers calculation of the estimated global position.  The
estimated position is now shown as a cyan circle in all images and
in the map.  Neither estimated position accuracy nor pointing
precision are bounded by pixel size.
</p>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4">Improve accuracy</h3>
<div class="outline-text-3" id="text-3-4">
<p>
Zooming in and pointing at the feature in some (or all) of the
remaining images improves accuracy.
</p>
</div>
</div>

<div id="outline-container-sec-3-5" class="outline-3">
<h3 id="sec-3-5">Store point</h3>
<div class="outline-text-3" id="text-3-5">
<p>
Finishing this point means storing it in a dedicated user point
table.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Deployment</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">Download</h3>
<div class="outline-text-3" id="text-4-1">
<ul class="org-ul">
<li>Browse Phoros source code via gitweb at <a href="http://github.com/trebb/phoros">Github</a>.
</li>

<li>Browse source code of <a href="mailto:Steffen.Scheller.home@gmail.com">Steffen Scheller</a>'s <a href="http://github.com/trebb/phoml">PhoML</a> library, which is
needed by Phoros.
</li>

<li>Get everything:
<div class="org-src-container">

<pre class="src src-sh">$ git clone git://github.com:trebb/phoros.git
$ <span style="font-weight: bold; font-style: italic;"># </span><span style="font-weight: bold; font-style: italic;">or: git clone https://github.com/trebb/phoros.git</span>
$ cd phoros
$ git submodule init
$ git submodule update
</pre>
</div>

<p>
The build process isn't perfect yet.  You'll (probably) need an
x86-64 Debian system with <a href="http://beta.quicklisp.org">Quicklisp</a> installed on top of <a href="http://www.sbcl.org">SBCL</a>.
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Debian Installation Walk-Through</h3>
<div class="outline-text-3" id="text-4-2">
<ul class="org-ul">
<li>Install Debian; choose standard system tools and (probably) SSH server.
</li>

<li>Install Debian packages
ed,
emacs,
fonts-sil-gentium,
g++,
git,
icoutils,
imagemagick,
proj-bin,
sbcl,
sbcl-source,
slime,
swig.
</li>

<li>Install (as a non-root user) quicklisp:
<div class="org-src-container">

<pre class="src src-sh">$ wget https://beta.quicklisp.org/quicklisp.lisp
$ sbcl --load quicklisp.lisp
</pre>
</div>
<p>
In SBCL, type
</p>
<div class="org-src-container">

<pre class="src src-lisp">(quicklisp-quickstart:install)
(ql:add-to-init-file)
(quit)
</pre>
</div>
</li>

<li>Build and install Phoros:
<div class="org-src-container">

<pre class="src src-sh">$ git clone ... <span style="font-weight: bold; font-style: italic;">#</span><span style="font-weight: bold; font-style: italic;">(see above)</span>
$ cd phoros
$ git submodule init
$ git submodule update
$ make bin-tarball
$ mkdir ~/phoros-workspace
$ cp ~/phoros/phoros_VERSION_x86_64.tar.gz ~/phoros-workspace/
$ cd ~/phoros-workspace
$ tar -xzf phoros_VERSION_x86_64.tar.gz
$ ln -s phoros_VERSION_x86_64 phoros
$ cd ~/phoros-workspace/phoros
$ ./phoros --check-dependencies
$ ./phoros --check-db --host=DB_HOST --user=DB_USER --password=SECRET --database=PHOROS_WORKSPACE_DB --aux-host=DB_HOST --aux-user=DB_USER --aux-password=SECRET --aux-database=PHOROS_WORKSPACE_DB
$ ./phoros --create-sys-tables --host=DB_HOST --user=DB_USER --password=SECRET --database=PHOROS_WORKSPACE_DB
</pre>
</div>
</li>

<li>Peruse the <a href="deployment.html">example scripts</a> and the <a href="phoros--help.html">help message</a> to learn about Phoros administration.
</li>

<li>Building fasttrack:
Install Debian package libmagickwand-dev
<div class="org-src-container">

<pre class="src src-sh">$ cd ~/quicklisp/local-projects
$ git clone git://github.com/TBRSS/lisp-magick-wand
</pre>
</div>
<p>
In lisp-magick-wand/base.lisp change
</p>
<div class="org-src-container">

<pre class="src src-lisp">(<span style="font-weight: bold;">:unix</span> (<span style="font-weight: bold;">:or</span> <span style="font-style: italic;">"libMagickWand.so"</span> <span style="font-style: italic;">"libWand.so.9"</span> <span style="font-style: italic;">"libWand.so"</span>))
</pre>
</div>
<p>
into
</p>
<div class="org-src-container">

<pre class="src src-lisp">(<span style="font-weight: bold;">:unix</span> (<span style="font-weight: bold;">:or</span> <span style="font-style: italic;">"libMagickWand-6.Q16.so"</span> <span style="font-style: italic;">"libMagickWand.so"</span> <span style="font-style: italic;">"libWand.so.9"</span> <span style="font-style: italic;">"libWand.so"</span>))
</pre>
</div>
<div class="org-src-container">

<pre class="src src-sh">$ make fasttrack
</pre>
</div>
</li>

<li>For use with firefox from fasttrack, set in about:config
browser.link.open<sub>newwindow</sub>.override.external to 1.
</li>
</ul>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Licence</h2>
<div class="outline-text-2" id="text-5">
<p>
PHOROS &#x2013; Photogrammetric Road Survey
</p>

<p>
Copyright (C) 2010, 2011, 2012, 2015, 2016 <a href="mailto:Bert%20Burgemeister%20<trebbu@googlemail.com>">Bert Burgemeister</a>
</p>

<p>
This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either <a href="http://www.gnu.org/licenses/gpl-2.0.html">version 2 of the License</a>, or
(at your option) any later version.
</p>

<p>
This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.
</p>

<p>
You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
02110-1301 USA.
</p>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Acknowledgements</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li>Phoros is implemented using <a href="http://sbcl.org">Steel Bank Common Lisp</a>, a Common Lisp
implementation.
</li>

<li>Communication with <a href="http://postgresql.org">PostgreSQL</a> is provided by <a href="http://marijnhaverbeke.nl/postmodern/">Postmodern</a>.
</li>

<li>The presentation server is based on <a href="http://weitz.de/hunchentoot">Hunchentoot</a>.
</li>

<li>Almost everything visible in the web browser looks as it does
thanks to the <a href="http://openlayers.org">OpenLayers</a> library, interfaced by <a href="http://common-lisp.net/project/parenscript/">Parenscript</a> and
<a href="http://common-lisp.net/project/cl-json/">CL-JSON</a>.
</li>

<li>Without <a href="mailto:Steffen.Scheller.home@gmail.com">Steffen Scheller</a>'s photogrammetric library <a href="http://github.com/trebb/phoml">PhoML</a> Phoros's
presentation server couldn't do much beyond displaying
geolocated images.
</li>

<li>Once decoded, images are turned into something a web browser can
handle by <a href="http://www.xach.com/lisp/zpng/">ZPNG</a>.
</li>

<li>Leap second information is taken from the <a href="http://hpiers.obspm.fr/eop-pc">Earth Orientation Center</a>.
</li>

<li><a href="http://www.openstreetmap.org">OpenStreetMap</a> provides the map.  (Other map services can be used
as well, though.)
</li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p>The number of images can be specified
   during server start. Example: <code>phoros --server --images=N ...</code></p></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="author">Author: Bert Burgemeister</p>
<p class="email">Email: <a href="mailto:trebbu@googlemail.com">trebbu@googlemail.com</a></p>
<p class="date">Created: 2016-06-06 Mo 11:58</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
